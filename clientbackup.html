

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border - box;
    }

    .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .section-title {
        text-align: center;
        margin-bottom: 30px;
        color: --lightC;
    }

    .steps {
        color: var(--lightC);
        display: flex;
        justify-content: space - between;
        margin-bottom: 40px;
    }

    .step {
        flex: 1;
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #f6f8f9 0%, #e5ebee 100%);
        margin: 0 10px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .step-number {
        font-size: 2rem;
        color: #3498db;
        margin-bottom: 10px;
    }

    .features {
        color: var(--lightC);
        display: grid;
        grid-template-columns: repeat(auto - fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .feature {
        background: linear-gradient(135deg, #f6f8f9 0%, #e5ebee 100%);
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .supported-urls {
        color: var(--lightC);
        background: linear-gradient(135deg, #f6f8f9 0%, #e5ebee 100%);
        padding: 20px;
        border-radius: 8px;
        margin-top: 30px;
    }

    .supported-urls ul {
        display: grid;
        grid-template-columns: repeat(auto - fit, minmax(150px, 1fr));
        gap: 10px;
        list-style-type: none;
    }

    .troubleshooting {
        color: var(--lightC);
        background: linear-gradient(135deg, #f6f8f9 0%, #e5ebee 100%);
        padding: 20px;
        border-radius: 8px;
        margin-top: 30px;
    }

    @media(max-width: 768px) {
        .steps {
            flex-direction: column;
        }

        .step {
            margin: 10px 0;
        }
    }
</style>

<div class="container">
    <div class="input-container">
        <input type="text" class="url-input" id="teraboxUrl" placeholder="Enter Terabox URL" />
        <span class="paste-icon" onclick="handlePaste()">üìã</span>
        <div class="error-message" id="errorMessage">
            Please enter a valid Terabox URL
    </div>
    </div>
    <!--< center>
        <p class="Mod">
            <strong>TeraBox Online Video Player < /strong> <strong>Tera Box Player Without Login</strong>
                    <strong>TeraBox Viewer Without App </strong>
                    < /p>
                        </center> -->
                        <button class="watch-button" onclick="handleWatch()"> Watch Online </button>

                        <!--< p class="note wr">üôè Please < b> click on 1 AD < /b> üëÄ before leaving to Keep watching +
                                    supporting our site! üôÇ [it only takes a moment but makes a big difference]
        </p> -->

        <div class="loading" id="loading">
            <img src="https://i.imgur.com/llF5iyg.gif" alt="Loading" />
            <p>Loading...</p>
        </div>

        <div class="video-container" id="videoContainer">
            <iframe id="videoFrame" allowfullscreen> </iframe>
            </div>
            </div>

            <script>              
                // Extract video ID from Terabox URL
                function extractVideoId(url) {
                    try {
                        // Existing Terabox URL pattern
                        const existingMatches = url.match(/\/s\/(.+?)(?:\?|$)/);
                        if (existingMatches && existingMatches[1]) {
                            return existingMatches[1].substring(1);
                        }

                        // New URL pattern for 1024tera.com
                        const newMatches = url.match(/surl=([^&]+)/);
                        if (newMatches && newMatches[1]) {
                            return newMatches[1];
                        }

                        return null;
                    } catch (error) {
                        console.error('Error extracting video ID:', error);
                        return null;
                    }
                }

                // Handle Watch Button Click
                function handleWatch() {
                    const urlInput = document.getElementById('teraboxUrl');
                    const videoContainer = document.getElementById('videoContainer');
                    const videoFrame = document.getElementById('videoFrame');
                    const errorMessage = document.getElementById('errorMessage');
                    const loading = document.getElementById('loading');
                    const url = urlInput.value.trim();
                    const videoId = extractVideoId(url);

                    if (url) {
                        let id;

                        if (url.includes('surl=')) {
                            const urlParams = new URLSearchParams(new URL(url).search);
                            id = urlParams.get('surl');
                        }

                        else if (url.includes('/s/')) {
                            const parts = url.split('/s/');
                            if (parts.length > 1) {
                                id = parts[1].substring(1);
                            }
                        }

                        fetch('https://teraboxvideoplayer.one/wp-json/wp/v2/posts')
                            .then(response => response.json())
                            .then(posts => {
                                let ids = [];
                                posts.forEach(post => {
                                    const url_ids = post.slug;
                                    if (url_ids) {
                                        ids.push(url_ids);
                                    }
                                });
                                if (ids.some(postId => postId.toLowerCase() === id.toLowerCase())) {
                                    console.log('Already Have this data');
                                } else {
                                    addPost(url, id);
                                }
                            });
                    } else {
                        console.log('Please enter a valid URL');
                    }

                    if (videoId) {
                        errorMessage.style.display = 'none';
                        loading.style.display = 'block';
                        videoContainer.style.display = 'none';
                        // Update the browser URL with the query parameter
                        const currentUrl = window.location.href.split('?')[0];
                        const newUrl = `${currentUrl}?q = ${encodeURIComponent(url)}`;
                        window.history.replaceState(null, null, newUrl);
                        // Simulate a loading delay
                        setTimeout(() => {
                            loading.style.display = 'none';
                            videoFrame.src = `https://www.1024terabox.com/sharing/embed?surl=${videoId}`;
                            videoContainer.style.display = 'block';
                            // Scroll to video container
                            videoContainer.scrollIntoView({behavior: 'smooth'});
                        }, 2000);
                    } else {
                        errorMessage.style.display = 'block';
                        loading.style.display = 'none';
                        videoContainer.style.display = 'none';
                    }
                }

                function extractOpenGraphData(url) {
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const targetUrl = url;
                    console.log('targetUrl', targetUrl)
                    return fetch(proxyUrl + targetUrl)
                        .then(response => response.text())
                        .then(html => {
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');

                            let ogTitle = doc.querySelector('meta[property="og:title"]')?.getAttribute('content') ||
                                doc.querySelector('meta[name="og:title"]')?.getAttribute('content') ||
                                'No title found';

                            const ogImage = doc.querySelector('meta[property="og:image"]')?.getAttribute('content') ||
                                doc.querySelector('meta[name="og:image"]')?.getAttribute('content') || '';

                            ogTitle = ogTitle.replace(/(.*\.(mkv|mp4|avi|mov|wmv|flv|webm|mpeg|mpg|3gp|ogg|mpeg4))[^a-zA-Z0-9]*.*/i, '$1');
                            console.log('ogImage', ogImage)
                            return {ogTitle, ogImage};
                        })
                        .catch(error => {
                            console.error('Error fetching Open Graph data:', error);
                            return {ogTitle: 'Error fetching title', ogImage: ''};
                        });
                }




                function uploadToWordPress(base64Image, id) {
                    const token = localStorage.getItem('jwt'); // Ensure the token is available
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/'; // CORS proxy if needed

                    // Create a Blob from the Base64 string
                    const byteCharacters = atob(base64Image); // Decode the Base64 string into raw bytes
                    const byteArrays = [];
                    for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                        const slice = byteCharacters.slice(offset, offset + 512);
                        const byteNumbers = new Array(slice.length);
                        for (let i = 0; i < slice.length; i++) {
                            byteNumbers[i] = slice.charCodeAt(i);
                        }
                        const byteArray = new Uint8Array(byteNumbers);
                        byteArrays.push(byteArray);
                    }
                    const imageBlob = new Blob(byteArrays, {type: 'image/jpeg'}); // Specify the MIME type

                    const formDataForWP = new FormData();
                    const featureImageName = `${id}.jpg`; // You can customize the image name if necessary

                    formDataForWP.append('file', imageBlob, featureImageName); // Append the Base64 image as 'file'

                    const wpTargetUrl = 'https://teraboxvideoplayer.one/wp-json/wp/v2/media';

                    // Upload the image to WordPress server via REST API
                    return fetch(proxyUrl + wpTargetUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                        },
                        body: formDataForWP,
                    })
                        .then(response => response.json())
                        .then(imageData => {
                            console.log('imageData', imageData);
                            if (imageData.source_url) {

                                return {
                                    url: imageData.source_url,
                                    mediaId: imageData.id
                                };
                            } else {
                                console.log('Image upload to WordPress failed');
                            }
                        })
                        .catch(error => {
                            console.error('Error uploading to WordPress:', error);
                            
                        });
                }


                function addPost(url, id) {
                    const token = localStorage.getItem('jwt');
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';

                    extractOpenGraphData(url).then(data => {
                        const {ogTitle, ogImage} = data;

                        if (ogImage) {

                            return fetch(proxyUrl + ogImage)
                                .then(response => response.blob())
                                .then(blob => {
                                    const reader = new FileReader();

                                    reader.onloadend = function () {
                                        const base64Image = reader.result.split(',')[1];

                                        uploadToWordPress(base64Image, id).then(uploadedData => {
                                            const uploadedImageUrl = uploadedData.url;
                                            const mediaId = uploadedData.mediaId;
                                            const postContent = `
                                        <img src="${uploadedImageUrl}" alt="Image from the link" /><br />
                                        <p>üìÆ ùêÖùêÆùê•ùê• ùêïùê¢ùêùùêûùê® ùêãùê¢ùêßùê§ üìÆ</p>
                                        <p>
                                            <a href="https://www.teraboxplayer.online/?q=${encodeURIComponent(url)}" target="_blank">
                                                Watch Full Video Online
                                            </a>
                                        </p>
                                    `;

                                            console.log('postContent', postContent);
                                            fetch('https://teraboxvideoplayer.one/wp-json/wp/v2/posts', {
                                                method: "POST",
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                    'accept': 'application/json',
                                                    'Authorization': `Bearer ${token}`
                                                },
                                                body: JSON.stringify({
                                                    title: ogTitle || 'No title found',
                                                    content: postContent,
                                                    slug: id,
                                                    featured_media: mediaId,
                                                    status: 'publish'
                                                })
                                            })
                                                .then(response => response.json())
                                                .then(post => {
                                                    console.log(post);
                                                });
                                        });
                                    };

                                    reader.readAsDataURL(blob);
                                })
                                .catch(error => {
                                    console.error('Error fetching or converting image:', error);
                                });

                        } else {
                            console.log('No image found in Open Graph data');
                        }
                    });
                }

                fetch('https://teraboxvideoplayer.one/wp-json/jwt-auth/v1/token', {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'accept': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'REST1',
                        password: 'n9i%HWX9^S!SlA)P2Ux%xwtb'
                    })
                })
                    .then(response => response.json())
                    .then(user => {
                        localStorage.setItem('jwt', user.token);
                    });

                // Handle Paste Icon Click
                function handlePaste() {
                    navigator.clipboard.readText().then((text) => {
                        document.getElementById('teraboxUrl').value = text;
                    }).catch((err) => {
                        console.error('Failed to read clipboard: ', err);
                    });
                }

                // Check for Query Parameters and Auto-Load Video
                window.onload = function () {
                    const params = new URLSearchParams(window.location.search);
                    const url = params.get('q');
                    if (url) {
                        document.getElementById('teraboxUrl').value = url;
                        handleWatch();
                    }
                };
            </script>